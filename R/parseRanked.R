# ParseRanked - function to convert API output to data frame for an Over Time report from the 1.4 API
# returns a formatted data frame

ParseRanked <- function(report.data) {

  # jsonlite already makes this into a nice data frame for us
  data <- report.data$report$data

  elements <- report.data$report$elements$id
  metrics <- report.data$report$metrics$id

  if(length(elements)==1) {
    # We don't need to traverse down the data structure
    counts.df <- ldply(data$counts)
    names(counts.df) <- metrics #assign names to counts.df

    drops <- c("counts")
    rows.df <- data[,!(names(data) %in% drops)]

    formatted.df <- cbind(rows.df, counts.df)
  } else {
    # We need to work our way down the nested data structure
    formatted.df <- BuildInnerBreakdownsRecursively(data,elements,metrics,1,c())
  }

  return(formatted.df)

}